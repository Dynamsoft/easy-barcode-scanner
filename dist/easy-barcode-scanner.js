
Dynamsoft.DBRBundle = new Proxy({}, {
  get: function (target, name) {
    for(let _namespace of ['Core','License','CVR','DBR','Utility']){
      if(name in Dynamsoft[_namespace]){
        return Dynamsoft[_namespace][name];
      }
    }
  },
  set: function (target, name, value) {
    for(let _namespace of ['Core','License','CVR','DBR','Utility']){
      if(name in Dynamsoft[_namespace]){
        Dynamsoft[_namespace][name] = value;
      }
    }
  }
});/*!
* easy-barcode-scanner
* @version 11.0.3003 (build 2025-08-14T08:37:43.467Z)
* A wrapper for https://github.com/Dynamsoft/barcode-reader-javascript. Easier to use.
* The wrapper is under Unlicense, the Dynamsoft SDK it depended is still protected by copyright.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("dynamsoft-barcode-reader-bundle")):"function"==typeof define&&define.amd?define(["dynamsoft-barcode-reader-bundle"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).EasyBarcodeScanner=t(e.Dynamsoft.DBRBundle)}(this,(function(e){"use strict";
/*!
     * Dynamsoft JavaScript Library
     * @product Dynamsoft Camera JS Edition
     * @website http://www.dynamsoft.com
     * @copyright Copyright 2025, Dynamsoft Corporation
     * @author Dynamsoft
     * @version "1.0.8"
     */const t=[["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],["camera2 0,"],["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"]],i=/<style>([\s\S]*?)<\/style>/g,o=/style="([\s\S]*?)"/g,s=(e,t)=>{const{inlineScript2Blob:s,internalCss2Blob:a,insertInternalCss2ExistedSheet:n}=t||{};if(n){let t,o;for(let i=0;i<document.styleSheets.length;++i){const s=document.styleSheets[i];try{o=s.cssRules,t=s;break}catch(e){}}t&&(e=e.replace(i,((e,i,s,a)=>{let n=i.split("}");const r=n.length-1;let c=[],d=null,h=0;for(let e=0;e<r;++e){let t=0;for(;-1!==(t=n[e].indexOf("{",t));)h+=1,t+=1;if(d)1===h?(c.push(d+n[e]+"}"),d=null,h=0):(d+=n[e]+"}",--h);else{if(h<1)throw new Error("invalid style");1===h?(c.push(n[e].trimStart()+"}"),h=0):(d=n[e].trimStart()+"}",--h)}}if(d||h)throw new Error("invalid style");for(let e of c)t.insertRule(e,o.length);return""})))}const r=[];a&&(e=e.replace(i,((e,t,i,o)=>(r.push(new Blob([t],{type:"text/css"})),"<HasStyle></HasStyle>"))));const c=[];e=e.replace(o,((e,t,i,o)=>(c.push(t),"hasStyle")));const d=document.createElement("div");if(d.insertAdjacentHTML("beforeend",e),d.normalize(),a){const e=d.querySelectorAll("HasStyle");for(let t=0;t<r.length;t++){const i=r[t],o=e[t],s=document.createElement("link");s.rel="stylesheet",s.href=URL.createObjectURL(i),o.replaceWith(s)}}const h=d.querySelectorAll("[hasStyle]");for(let e=0;e<c.length;e++){const t=c[e],i=h[e];if(i instanceof HTMLElement){i.removeAttribute("hasStyle");const e=t.split(";");for(let t of e){const e=t.split(":");i.style[e[0]]=e[1]}}}for(let e of d.querySelectorAll("script")){const t=document.createElement("script");e.textContent&&(s&&!e.src?(t.src=URL.createObjectURL(new Blob([e.textContent],{type:"text/javascript"})),t.addEventListener("load",(()=>URL.revokeObjectURL(t.src)))):t.textContent=e.textContent);for(let i of e.attributes)t.setAttribute(i.name,i.value);e.replaceWith(t)}let l=new DocumentFragment;return l.append(...d.childNodes),1===l.childNodes.length?l.firstChild:l},a=e=>e&&"object"==typeof e&&"function"==typeof e.then,n=(async()=>{})().constructor;class r extends n{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,a(e)?t=e:"function"==typeof e&&(t=new n(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super(((e,o)=>{t=e,i=o})),this._s="pending",this.resolve=e=>{this.isPending&&(a(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const c={width:1280,height:720},d=function(){const e=this,t=MediaDeviceInfo.prototype.toJSON.apply(e);return t.trackLabel=e.trackLabel,t.capabilities=e.capabilities,t};class h{static _cameraNameMatcher=t;static _mapDeviceInfo;_coreShell;_video;_coreInnerLayer;_coreOuterLayer;_regionBoxWrapper;_regionBoxMask;_regionBoxBorder;_objectFit="contain";_uiInlineScript2Blob=!0;_uiInternalCss2Blob=!0;_uiInternalCss2ExistedSheet=!1;_ui;_pOpen;_paused=!1;_shouldClose=!1;_cameraChangedWhenPaused=!1;_resolutionChangedWhenPaused=!1;_requestedCamera="back";_requestedResolution=c;_regionBox={unit:"view-size",center:{x:0,y:0},maskStyle:{background:"rgba(0, 0, 0, 0.5)"},borderStyle:{border:"1px solid #00ff7f"}};_eventListeners={};static _arrConstructors=[];static _arrOnOpen=[];static _arrOnClose=[];constructor(){const e=this._coreShell=document.createElement("div");Object.assign(e.style,{width:"100%",height:"100%",minWidth:"100px",minHeight:"100px",backgroundColor:"black",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative"});const t=this._coreOuterLayer=document.createElement("div");Object.assign(t.style,{width:"auto",height:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"relative",overflow:"hidden"});const i=this._coreInnerLayer=document.createElement("div");Object.assign(i.style,{width:"100%",height:"100%",position:"relative",transformOrigin:"center"});const o=this._video=document.createElement("video");Object.assign(o.style,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",objectFit:"fill"}),o.muted=!0,o.playsInline=!0,i.append(o),t.append(i),e.append(t),new ResizeObserver((()=>{this._updateObjectFit()})).observe(e);for(let e of h._arrConstructors)e.call(this)}_updateObjectFit(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video,t=this._coreOuterLayer.style,i=this._regionBoxWrapper?.style;if("fill"===this._objectFit)return"100%"!==t.width&&(t.width="100%"),"100%"!==t.height&&(t.height="100%"),void(i&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%")));const{width:o,height:s}=this._coreShell.getBoundingClientRect(),a=`${e.videoWidth} / ${e.videoHeight}`;a!=t.aspectRatio&&(t.aspectRatio=a),i&&a!=i.aspectRatio&&(i.aspectRatio=a);let n=!1;o/s>e.videoWidth/e.videoHeight&&(n=!n),"cover"===this._objectFit&&(n=!n);const r=i&&"contain"===this._objectFit,c=i&&"cover"===this._objectFit;n?("auto"!=t.width&&(t.width="auto"),"100%"!=t.height&&(t.height="100%"),r&&("auto"!=i.width&&(i.width="auto"),"100%"!=i.height&&(i.height="100%"))):("100%"!=t.width&&(t.width="100%"),"auto"!=t.height&&(t.height="auto"),r&&("100%"!=i.width&&(i.width="100%"),"auto"!=i.height&&(i.height="auto"))),c&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%"))}get video(){return this._video}get track(){return this._video?.srcObject?.getTracks()[0]}get objectFit(){return this._objectFit}set objectFit(e){this._objectFit=e,this._updateObjectFit()}get ui(){return this._ui||this._coreShell}set ui(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if("string"==typeof e){if(!e.trim().startsWith("<"))throw Error("Invalid html string.");e=s(e,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet})}let t;if(e instanceof HTMLElement)t=e;else{if(!(e instanceof DocumentFragment))throw Error("Seems no HTMLElement.");t=document.createElement("div"),t.append(e)}const i="dm-camera-core-container",o=t.classList.contains(i)?t:t.querySelector(`.${i}`);if(!o)throw Error(`Can't find element with class \`${i}\`.`);this._ui=t;for(let e of t.querySelectorAll("script"))e.currentDMCamera=this;o.append(this._coreShell)}get status(){return this._pOpen?this._pOpen.isPending?this._shouldClose?"closing":"opening":this._paused?"paused":"opened":"closed"}get requestedCamera(){return this._requestedCamera}get requestedResolution(){return this._requestedResolution}get currentCamera(){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");return h._mapDeviceInfo?.[this.track?.getSettings()?.deviceId]}get currentResolution(){return{width:this.video?.videoWidth,height:this.video?.videoHeight}}get regionBox(){return this._regionBox}onOpened;static async hasCamera(){return!!(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length}static async hasMacroCamera(){return!!(await h.getDeviceInfos()).find((e=>e.capabilities?.facingMode?.includes("environment")&&e.capabilities?.focusDistance?.min<.061))}static async getDeviceInfos(){let e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));if(!e.length)return[];if(e.some((e=>!e.deviceId))){let t;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)),e.some((e=>!e.deviceId))&&console.warn("Some camera does not have deviceId.")}catch(e){console.warn("Failed to get device ID by opening camera.",e)}if(t){const i=t.getTracks().filter((e=>"video"===e.kind))[0],o=i.getSettings().deviceId;let s=e.find((e=>e.deviceId===o));s?(s.trackLabel=i.label,s.capabilities=i.getCapabilities?.(),s.toJSON=d):console.warn("Can't find current device by `track.getSettings().deviceId`."),t.getTracks().forEach((e=>e.stop()))}}await h._setCapabilities(e);const t=e.reduce(((e,t)=>(e[t.deviceId]=t,e)),{});return h._mapDeviceInfo=t,[...e]}static async _setCapabilities(e){for(let t of e){if(!t.deviceId)continue;if(d===t.toJSON)continue;let i=h._mapDeviceInfo?.[t.deviceId];if(i)t.trackLabel=i.trackLabel,t.capabilities=i.capabilities;else try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:t.deviceId},audio:!1}),i=e.getTracks().filter((e=>"video"===e.kind))[0];t.trackLabel=i.label,t.capabilities=i.getCapabilities?.(),e.getTracks().forEach((e=>e.stop()))}catch(e){console.warn("Failed to get `trackLabel` and `capabilities`, by opening camera.",e)}t.toJSON=d}}async open(){if("opened"!==this.status)if("closed"===this.status||"paused"===this.status)try{if("paused"===this.status&&this._cameraChangedWhenPaused&&(await this.close(),this._cameraChangedWhenPaused=!1),"closed"===this.status){if(this._pOpen=new r,"customized-video"!==this._requestedCamera){let e;if("string"==typeof this._requestedCamera){switch(this._requestedCamera){case"front":e={facingMode:"user"};break;case"quick-back":e={facingMode:"environment"};break;case"back":{const t=await h.getDeviceInfos();if(!t.length)throw Error("No camera found.");for(let i of h._cameraNameMatcher){for(let o of t){const t=(o.trackLabel||o.label)?.toLowerCase();for(let s of i)if(t.includes(s)){e={deviceId:o.deviceId};break}if(e)break}if(e)break}if(e)break;t.reverse();for(let i of t)if(i.capabilities?.facingMode?.includes("environment")){e={deviceId:i.deviceId};break}e={deviceId:t[0].deviceId};break}case"macro-back":{const t=await h.getDeviceInfos();if(!t.length)throw Error("No camera found.");const i=t.reduce(((e,t)=>t?.capabilities?.facingMode?.includes("environment")&&(!e||e?.capabilities?.focusDistance?.min||t?.capabilities?.focusDistance?.min<e?.capabilities?.focusDistance?.min)?t:e));e={deviceId:i?.deviceId||t[t.length-1].deviceId};break}default:throw Error(`Unknown camera preset: ${this._requestedCamera}`)}this._requestedCamera=e}else e=this._requestedCamera;const t={video:Object.assign({},e,this._requestedResolution),audio:!1},i=await navigator.mediaDevices.getUserMedia(t);if("closing"===this.status)throw Error("Camera closed.");this._video.srcObject=i}if(await this._video.play(),"closing"===this.status)throw Error("Camera closed.");this._pOpen.resolve();try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}}else{if(this._pOpen=new r,await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this._paused=!1,this._pOpen.resolve(),this._resolutionChangedWhenPaused){try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._resolutionChangedWhenPaused=!1}}for(let e of h._arrOnOpen)e.call(this);this._callOpenedListeners()}catch(e){for(let e of this._video?.srcObject?.getTracks())e?.stop();this._video.srcObject=null;const t=this._pOpen;throw this._pOpen=null,this._shouldClose=!1,t.reject(),Error(`Error opening camera: ${e?.message}`,{cause:e})}else{if("opening"!==this.status&&"closing"!==this.status)throw Error("Never");await this._pOpen}}async pause(){try{await this._pOpen}catch(e){}"opened"===this.status&&(this._video.pause(),this._paused=!0)}async close(){if("closed"!==this.status)if("opening"===this.status&&(this._shouldClose=!0),"closing"!==this.status){for(let e of this._video?.srcObject?.getTracks())e?.stop();this._video.srcObject=null,this._pOpen=null,this._paused=!1;for(let e of h._arrOnClose)e.call(this)}else try{await this._pOpen}catch(e){}}async requestCamera(e){"string"==typeof e?l.includes(e)?this._requestedCamera=e:this._requestedCamera={deviceId:e}:e?"videoinput"===e.kind?e.deviceId?this._requestedCamera={deviceId:e.deviceId}:this._requestedCamera="back":this._requestedCamera=JSON.parse(JSON.stringify(e)):null===e?this._requestedCamera=null:void 0===e&&(this._requestedCamera="back"),"opened"===this.status?(await this.close(),await this.open()):"paused"===this.status&&(this._cameraChangedWhenPaused=!0)}async requestResolution(e,t){let i={};if("number"==typeof e?(i.width=e,"number"==typeof t&&(i.height=t)):Array.isArray(e)?(e[0]&&(i.width=e[0]),e[1]&&(i.height=e[1])):e?((e=JSON.parse(JSON.stringify(e))).width&&(i.width=e.width),e.height&&(i.height=e.height),e.aspectRatio&&(i.aspectRatio=e.aspectRatio)):null===e?i=null:void 0===e&&(i=c),this._requestedResolution=i,"opened"===this.status){await this.track.applyConstraints({...i});const t=this.track.getSettings();let o=0;for(;++o<10&&(t.width!==this.video.videoWidth||t.height!==this.video.videoHeight);)await new Promise((e=>setTimeout(e,100)));try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._callOpenedListeners()}else"paused"===this.status&&(this._resolutionChangedWhenPaused=!0,await this.track.applyConstraints({...i}))}getFrame(e){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");let{x:t=0,y:i=0,width:o=this._video.videoWidth,height:s=this._video.videoHeight,reusedContext:a}=e||{};o=Math.round(o+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const n=a?.canvas||document.createElement("canvas");return n.width!=o&&(n.width=o),n.height!=s&&(n.height=s),(a||n.getContext("2d")).drawImage(this._video,t,i,o,s,0,0,o,s),n}setRegionBox(e){if(!(e=Object.assign(this._regionBox,e)).width||!e.height)return this._regionBoxWrapper?.remove(),this._regionBoxWrapper=null,this._regionBoxMask=null,void(this._regionBoxBorder=null);this._regionBoxWrapper||(this._regionBoxWrapper=document.createElement("div"),Object.assign(this._regionBoxWrapper.style,{width:"auto",height:"100%",maxWidth:"100%",maxHeight:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",containerType:"size"}),this._regionBoxMask=document.createElement("div"),Object.assign(this._regionBoxMask.style,{width:"100%",height:"100%",flex:"none"}),this._regionBoxWrapper.append(this._regionBoxMask),this._regionBoxBorder=document.createElement("div"),Object.assign(this._regionBoxBorder.style,{flex:"none",boxSizing:"content-box",position:"absolute"}),this._regionBoxWrapper.append(this._regionBoxBorder),this._coreShell.append(this._regionBoxWrapper)),e.innerUi instanceof HTMLElement?e.innerUi.parentElement!==this._regionBoxBorder&&this._regionBoxBorder.append(e.innerUi):"string"==typeof e.innerUi?this._regionBoxBorder.append(s(e.innerUi)):this._regionBoxBorder.innerHTML="";let t=100*e.center.y-50*e.height+50+"%",i=100*e.center.x+50*e.width+50+"%",o=100*e.center.y+50*e.height+50+"%",a=100*e.center.x-50*e.width+50+"%";Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${a} ${t}, ${a} ${o}, ${i} ${o}, ${i} ${t}, ${a} ${t})`}),"view-min"===e.unit&&(t=`calc(${100*e.center.y+50}% + max(-${50*e.height}cqmin, -${50*e.height}cqmax))`,i=`calc(${100*e.center.x+50}% + ${50*e.width}cqmin)`,o=`calc(${100*e.center.y+50}% + ${50*e.height}cqmin)`,a=`calc(${100*e.center.x+50}% + max(-${50*e.width}cqmin, -${50*e.width}cqmax))`,Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${a} ${t}, ${a} ${o}, ${i} ${o}, ${i} ${t}, ${a} ${t})`})),Object.assign(this._regionBoxMask.style,{...e.maskStyle}),Object.assign(this._regionBoxBorder.style,{width:100*e.width+"%",height:100*e.height+"%"}),"view-min"===e.unit&&Object.assign(this._regionBoxBorder.style,{width:100*e.width+"cqmin",height:100*e.height+"cqmin"}),Object.assign(this._regionBoxBorder.style,{...e.borderStyle}),this._updateObjectFit()}addCanvas(){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),"opened"!==this.status&&"paused"!==this.status||(e.width=this._video.videoWidth,e.height=this._video.videoHeight),this._video.parentElement.append(e),e}_updateCanvasSize(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video;this._video.parentElement.querySelectorAll("canvas").forEach((t=>{t.width!==e.videoWidth&&(t.width=e.videoWidth),t.height!==e.videoHeight&&(t.height=e.videoHeight)}))}addEventListener(e,t){(this._eventListeners[e]??=new Set).add(t)}removeEventListener(e,t){this._eventListeners[e]?.delete(t)}_callOpenedListeners(){try{this.onOpened?.(this)}catch(e){console.error(e)}this._eventListeners.opened?.forEach((e=>{try{e(this)}catch(e){console.error(e)}}))}videoXY2AbsoluteLT(e){const t=this._video,i=t.getBoundingClientRect(),o=getComputedStyle(document.body);if("static"===o.position){const o=document.documentElement.getBoundingClientRect();return e.map((e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-o.x,top:e.y/t.videoHeight*i.height+i.y-o.y})))}{const s=document.body.getBoundingClientRect(),a=parseFloat(o.borderLeftWidth),n=parseFloat(o.borderTopWidth);return e.map((e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-s.x-a,top:e.y/t.videoHeight*i.height+i.y-s.y-n})))}}videoXY2FixedLT(e){const t=this._video,i=t.getBoundingClientRect();return e.map((e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x,top:e.y/t.videoHeight*i.height+i.y})))}getVisibleAreaInVideoXY(e){const{isConsiderRegionBox:t=!1,rounded:i=!1}=e||{};let o;if(t&&this._regionBoxBorder){const e=this._regionBoxBorder.getBoundingClientRect();o={x:e.x,y:e.y,width:e.width,height:e.height};const t=getComputedStyle(this._regionBoxBorder),i=parseFloat(t.borderLeftWidth),s=parseFloat(t.borderTopWidth),a=parseFloat(t.borderRightWidth),n=parseFloat(t.borderBottomWidth);o.x+=i,o.y+=s,o.width-=i+a,o.height-=s+n}else{const e=this._coreShell.getBoundingClientRect();o={x:e.x,y:e.y,width:e.width,height:e.height}}const s=this._video.getBoundingClientRect(),a={x:(o.x-s.x)/s.width,y:(o.y-s.y)/s.height,width:o.width/s.width,height:o.height/s.height};a.x<0&&(a.width+=a.x,a.x=0),a.x>1&&(a.width-=a.x-1,a.x=1),a.y<0&&(a.height+=a.y,a.y=0),a.y>1&&(a.height-=a.y-1,a.y=1),a.x+a.width>1&&(a.width=1-a.x),a.x+a.width<0&&(a.width=-a.x),a.y+a.height>1&&(a.height=1-a.y),a.y+a.height<0&&(a.height=-a.y);const n=this._video.videoWidth,r=this._video.videoHeight;let c=(this.isMirrored?1-a.x-a.width:a.x)*n,d=a.y*r,h=a.width*n,l=a.height*r;return i&&(h=Math.round(h+c)-Math.round(c),l=Math.round(l+d)-Math.round(d),c=Math.round(c),d=Math.round(d)),{x:c,y:d,width:h,height:l}}}const l=["back","front","macro-back","quick-back","customized-video"];h._arrConstructors.push((function(){const e=this;e._softZoom={zoom:1,center:{x:0,y:0}},e.maxZoom4GestureWheel=20,e._lastZoomTime=-1/0,e._mapZoomTouchs=new Map,e.enableGestureZoom=!0,e.enableWheelZoom=!0})),Object.defineProperty(h.prototype,"softZoom",{get(){return this._softZoom}}),Object.defineProperty(h.prototype,"isMirrored",{get(){return this._isMirrored},set(e){const t=this;t._isMirrored=e,t.setSoftZoom(t.softZoom.zoom,{center:t.softZoom.center})}}),Object.defineProperty(h.prototype,"enableGestureZoom",{get(){return!!this._gestureZoomListener},set(e){const t=this;e?t._gestureZoomListener||(t._gestureZoomListener=e=>{t._changeZoomByTouch(e)},t._coreShell.addEventListener("touchstart",t._gestureZoomListener),t._coreShell.addEventListener("touchmove",t._gestureZoomListener),t._coreShell.addEventListener("touchend",t._gestureZoomListener),t._coreShell.addEventListener("touchcancel",t._gestureZoomListener)):t._gestureZoomListener&&(t._coreShell.removeEventListener("touchstart",t._gestureZoomListener),t._coreShell.removeEventListener("touchmove",t._gestureZoomListener),t._coreShell.removeEventListener("touchend",t._gestureZoomListener),t._coreShell.removeEventListener("touchcancel",t._gestureZoomListener),t._gestureZoomListener=null)}}),Object.defineProperty(h.prototype,"enableWheelZoom",{get(){return!!this._wheelZoomListener},set(e){const t=this;e?t._wheelZoomListener||(t._wheelZoomListener=e=>{t._changeZoomByWheel(e)},t._coreShell.addEventListener("wheel",t._wheelZoomListener)):t._wheelZoomListener&&(t._coreShell.removeEventListener("wheel",t._wheelZoomListener),t._wheelZoomListener=null)}}),h.prototype.getZoomRange=function(){if("opened"!==this.status)throw Error("Camera is not opened");return this.track.getCapabilities?.()?.zoom},h.prototype.setZoom=async function(e){if("opened"!==this.status)throw Error("Camera is not opened");await this.track.applyConstraints({advanced:[{zoom:e}]})},h.prototype.setSoftZoom=function(e,t){const i=this;let{center:o,limit:s}=t||{},{x:a=0,y:n=0}=o||{};s&&e<1&&(e=1);let r=i._isMirrored?`scale(${-e},${e})`:`scale(${e})`;if(o){if(s){const t=.5-.5/e;a<-t?a=-t:a>t&&(a=t),n<-t?n=-t:n>t&&(n=t)}r+=` translate(${a*=-100}%, ${n*=-100}%)`}i._softZoom={zoom:e,center:{x:a,y:n}},i._coreInnerLayer.style.transform=r},h.prototype._changeZoomByWheel=function(e){const t=this,i=Date.now();let o=t._softZoom.zoom,s=o-e.deltaY/200;s>t.maxZoom4GestureWheel&&(s=t.maxZoom4GestureWheel),s<1&&(s=1),s!==o&&(t.setSoftZoom(s,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,e.preventDefault(),t._eventListeners.zoom?.forEach((e=>{try{e(JSON.parse(JSON.stringify(t._softZoom)),t)}catch(e){console.error(e)}})))},h.prototype._changeZoomByTouch=function(e){const t=this;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=Date.now();if(i-t._lastZoomTime<100)return;let o=e.touches[0],s=e.touches[1],a=t._mapZoomTouchs.get(o.identifier),n=t._mapZoomTouchs.get(s.identifier);if(!a||!n)break;let r=Math.pow(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2),.5),c=Math.pow(Math.pow(o.clientX-s.clientX,2)+Math.pow(o.clientY-s.clientY,2),.5),d=t._softZoom.zoom;d*=c/r,d>t.maxZoom4GestureWheel&&(d=t.maxZoom4GestureWheel),d<1&&(d=1),t.setSoftZoom(d,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,t._eventListeners.zoom?.forEach((e=>{try{e(t)}catch(e){console.error(e)}}));break}t._mapZoomTouchs.clear();for(let i of e.touches)t._mapZoomTouchs.set(i.identifier,{x:i.clientX,y:i.clientY})},h._arrConstructors.push((function(){const e=this;e._isFocusing=!1,e._advancedFocusParameters={minFocusDistanceLimit:.01,maxFocusDistanceLimit:10,firstStepWaitDuration:500,coarseStepWaitDuration:350,switchStepWaitDuration:400,fineStepWaitDuration:350,maxStepCount:30,backToContinousDuration:5e3,focusWH:.2,coarseTuneRate:.5,coarseTuneTolerance:.5,fineTuneRate:1.1},e._advancedFocusTaskId=0,e.enableTapToFocus="simple"})),h._getImageContrast=(e,t,i)=>{let o=0;for(let s=0;s<i-1;s++)for(let i=0;i<t-1;i++){const a=4*(s*t+i),n=a+4,r=a+4*t,c=e[a]-e[n],d=e[a+1]-e[n+1],h=e[a+2]-e[n+2],l=e[a]-e[r],u=e[a+1]-e[r+1],p=e[a+2]-e[r+2];o+=c*c+d*d+h*h+l*l+u*u+p*p}return o},h.prototype._simpleFocus=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(e._isFocusing)return;const t=e.currentCamera?.capabilities;let i,o;if(t?.focusMode?.includes("manual"))if(t?.focusMode?.includes("continuous"))i="manual",o="continuous";else{if(!t?.focusMode?.includes("single-shot"))return void e._advancedFocus();i="manual",o="single-shot"}else if(t?.focusMode?.includes("single-shot"))t?.focusMode?.includes("continuous")?(i="continuous",o="single-shot"):(i=null,o="single-shot");else{if(!t?.focusMode?.includes("continuous"))return;i=null,o="continuous"}e._isFocusing=!0;try{i&&("manual"===i?await e.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t?.focusDistance?.max||10}]}):await e.track.applyConstraints({advanced:[{focusMode:i}]}),await new Promise((e=>setTimeout(e,500)))),await e.track.applyConstraints({advanced:[{focusMode:o}]}),await new Promise((e=>setTimeout(e,500)))}catch(t){"opened"===e.status&&console.warn("Error while do simple focus",t)}e._isFocusing=!1},h.prototype._advancedFocus=async function(e,t,i){const o=this;if("opened"!==o.status)throw Error("Camera is not opened");if(o._isFocusing)return;const s=o.currentCamera?.capabilities;if(!s?.focusMode?.includes("manual"))return void o._simpleFocus();const a=o._advancedFocusParameters,n=o._video.videoWidth,r=o._video.videoHeight;if(n<2||r<2)return;let c,d=0;e?(e.x=Math.round(e.x),e.y=Math.round(e.y),t||(t=Math.min(n,r)*a.focusWH),t<2&&(t=2),t>n&&(t=n),t=2*Math.round(t/2),i||(i=t),i<2&&(i=2),i>r&&(i=r),i=2*Math.round(i/2),e.x<t/2&&(e.x=t/2),e.x>n-t/2&&(e.x=n-t/2),e.y<i/2&&(e.y=i/2),e.y>r-i/2&&(e.y=r-i/2),d=e.x-t/2,c=e.y-i/2):(t=n,i=r),o._isFocusing=!0;const l=++o._advancedFocusTaskId;let u=s?.focusDistance?.min;(!u||u<a.minFocusDistanceLimit)&&(u=a.minFocusDistanceLimit);let p=s?.focusDistance?.max;(!p||p>a.maxFocusDistanceLimit)&&(p=a.maxFocusDistanceLimit);let m=-1/0,g=-1/0,_=1/0,f=p,y=!1,v=!0;const w=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});let b=0;try{for(;++b<a.maxStepCount;){let e;await o.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),y?v?(v=!1,e=a.switchStepWaitDuration):e=a.fineStepWaitDuration:v?(v=!1,e=a.firstStepWaitDuration):e=a.coarseStepWaitDuration,await new Promise((t=>setTimeout(t,e))),o.getFrame({x:d,y:c,width:t,height:i,reusedContext:w});const s=w.getImageData(0,0,t,i).data,n=h._getImageContrast(s,t,i);if(y){if(n<=m){await o.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:_}]}),await o.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:_}]});break}if(p===f)break;m=n,n>g&&(g=n,_=f),f*=a.fineTuneRate,f>p&&(f=p)}else(n<=g*a.coarseTuneTolerance||u===f)&&(y=!0),m=n,n>g&&(g=n,_=f),y?(f=Math.sqrt(f*_),v=!0):(f*=a.coarseTuneRate,f<u&&(f=u))}}catch(e){"opened"===o.status&&console.warn("Error while do advanced focus",e)}o._isFocusing=!1,a.backToContinousDuration>0&&setTimeout((async()=>{if(o._advancedFocusTaskId===l)try{await o.track.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(e){}}),a.backToContinousDuration)},Object.defineProperty(h.prototype,"enableTapToFocus",{get(){return this._enableTapToFocus},set(e){const t=this;t._enableTapToFocus=e,e?t._tapToFocusListner||(t._tapToFocusListner=async e=>{if(!("opened"!==t.status||!t._enableTapToFocus||!e.isPrimary||e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||"touch"===e.pointerType&&t.enableGestureZoom&&(await new Promise((e=>setTimeout(e,300))),"opened"!==t.status||!t._enableTapToFocus||t._lastZoomTime>Date.now()-1e3||t._mapZoomTouchs.size>1)))if("experimental-advanced"===t._enableTapToFocus){const[{left:i,top:o},{left:s,top:a}]=t.videoXY2FixedLT([{x:0,y:0},{x:t._video.videoWidth,y:t._video.videoHeight}]);t._advancedFocus({x:(e.clientX-i)/(s-i)*t._video.videoWidth,y:(e.clientY-o)/(a-o)*t._video.videoHeight})}else t._simpleFocus()},t._coreShell.addEventListener("pointerdown",t._tapToFocusListner)):t._tapToFocusListner&&(t._coreShell.removeEventListener("pointerdown",t._tapToFocusListner),t._tapToFocusListner=null)}}),h._arrConstructors.push((function(){this._isTorchOn=!1,this._autoTorchParameters={shortDelay:250,longDelay:1e3,shortLongDelaySwitchCount:10,maxErrorCount:10,grayThreshold:20,maxDarkCount:3}})),h._arrOnClose.push((function(){this._isTorchOn=!1})),Object.defineProperty(h.prototype,"isSupportTorch",{get(){return!!this.currentCamera?.capabilities?.torch}}),Object.defineProperty(h.prototype,"isTorchOn",{get(){return this._isTorchOn}}),h.prototype.turnOnTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");try{await e.track.applyConstraints({advanced:[{torch:!0}]})}catch(t){throw e._isTorchOn=!1,t}e._isTorchOn=!0},h.prototype.turnOffTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");await e.track.applyConstraints({advanced:[{torch:!1}]}),e._isTorchOn=!1},h.prototype.turnAutoTorch=function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(null==e._isTorchOn)return;e._isTorchOn=void 0;const t=e._autoTorchParameters,i=document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});let s=0,a=0,n=0;(async()=>{for(;null==e._isTorchOn;){try{e.getFrame({reusedContext:o})}catch(i){if("opened"===e.status&&++s<t.maxErrorCount){await new Promise((e=>setTimeout(e,1e3)));continue}e._isTorchOn=!1;break}const r=o.getImageData(0,0,i.width,i.height).data;let c=0;for(let e=0;e<r.length;e+=4)c+=r[e]+r[e+1]+r[e+2];if(c/=r.length/4*3,c<t.grayThreshold&&++a>=t.maxDarkCount){try{await e.turnOnTorch(),e._eventListeners.torchAutoOn?.forEach((t=>{try{t(e)}catch(e){console.error(e)}}))}catch(e){console.warn("Error while do auto torch",e)}break}await new Promise((e=>setTimeout(e,n<t.shortLongDelaySwitchCount?t.shortDelay:t.longDelay))),++n}})()},h._arrConstructors.push((function(){this._shouldCloseWhenHide=!0,this._maxReopenTry4CloseWhenHide=4})),h._arrOnOpen.push((function(){const e=this;e._shouldCloseWhenHide&&(e._closeWhenHideListener||(e._closeWhenHideListener=()=>{e._closeWhenHide()},document.addEventListener("visibilitychange",e._closeWhenHideListener)))})),h._arrOnClose.push((function(){const e=this;e._closeWhenHideListener&&"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",e._closeWhenHideListener),e._closeWhenHideListener=null)})),Object.defineProperty(h.prototype,"shouldCloseWhenHide",{get(){return this._shouldCloseWhenHide},set(e){const t=this;t._shouldCloseWhenHide=e,"opened"===t.status&&(e?t._closeWhenHideListener||(t._closeWhenHideListener=()=>{t._closeWhenHide()},document.addEventListener("visibilitychange",t._closeWhenHideListener)):t._closeWhenHideListener&&(document.removeEventListener("visibilitychange",t._closeWhenHideListener),t._closeWhenHideListener=null))}}),h.prototype._closeWhenHide=async function(){const e=this;if("hidden"===document.visibilityState)"opened"===e.status&&(e._isOpenBeforeHide=!0,await e.close());else if(e._isOpenBeforeHide){let t=0;for(;t++<e._maxReopenTry4CloseWhenHide&&"visible"===document.visibilityState;){try{await e.open()}catch(e){await new Promise((e=>setTimeout(e,300)));continue}e._isOpenBeforeHide=!1;break}}};class u{camera;_ctx;_data;_dataTime=-1/0;_x;_y;_w;_h;_type;maxTimeout=500;_pipeTaskId;isSaveOriginalRgba=!1;originalRbga;constructor(e){this.camera=e;const t=document.createElement("canvas");this._ctx=t.getContext("2d",{willReadFrequently:!0})}_getDate(){this.camera.getFrame({x:this._x,y:this._y,width:this._w,height:this._h,reusedContext:this._ctx});const e=this._ctx.getImageData(0,0,this._w,this._h).data;if(this.originalRbga=this.isSaveOriginalRgba?e:null,"rgba"===this._type)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const t=new Uint8Array(e.length/4);for(let i=0;i<e.length;i+=4)t[i/4]=.3*e[i]+.59*e[i+1]+.11*e[i+2];return t}getData(e){let{x:t=0,y:i=0,width:o=this.camera._video.videoWidth,height:s=this.camera._video.videoHeight,type:a="rgba"}=e||{};o=Math.round(o+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const n=t!==this._x||i!==this._y||o!==this._w||s!==this._h||a!==this._type;let r;return n&&(this._x=t,this._y=i,this._w=o,this._h=s,this._type=a),!n&&this._dataTime+this.maxTimeout>Date.now()&&this._data?(r=this._data,this._data=null):r=this._getDate(),this._pipeTaskId||(this._pipeTaskId=setTimeout((()=>{this._pipeTaskId=null,this._data=this._getDate(),this._dataTime=Date.now()}),0)),r}}class p{_stAudioFree=new Set;_stAudioPlaying=new Set;_timeLastPlay=0;_bWarnedMaxTrack=!1;maxPlayingBeep=16;beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";beep(){if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-this._timeLastPlay<100)){if(this._timeLastPlay=t,this._stAudioFree.size&&(e=this._stAudioFree.values().next().value,this.beepSoundSource==e.src?(this._stAudioFree.delete(e),e.play()):e=null),!e)if(this._stAudioPlaying.size<this.maxPlayingBeep){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout((()=>{this._stAudioPlaying.delete(e)}),2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",(()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,this._stAudioPlaying.delete(e),this._stAudioFree.add(e)}))}else this._bWarnedMaxTrack||(this._bWarnedMaxTrack=!0,console.warn(`The requested audio tracks exceed ${this.maxPlayingBeep} and will not be played.`));e&&this._stAudioPlaying.add(e)}}}let m;if(e.CoreModule.engineResourcePaths.rootDirectory="https://cdn.jsdelivr.net/npm/",null!=typeof document){let t=null===document||void 0===document?void 0:document.currentScript;if(t){let i=t.getAttribute("data-license");i&&(e.LicenseManager.license=i)}}class g{constructor(){this.templateName="ReadBarcodes_SpeedFirst",this.barcodeFillStyle="rgba(0,255,0,0.5)",this.barcodeStrokeStyle="rgba(0,255,0,1)",this.barcodeLineWidth=1,this._isBeepOnUniqueRead=!0,this._isVibrateOnUniqueRead=!1,this.decodeInterval=100,this._isSaveOriginalCanvas=!1,this._loopDecodingTaskId=0,this._isLoopingDecoding=!1}static get license(){return e.LicenseManager.license}static set license(t){e.LicenseManager.license=t}get isBeepOnUniqueRead(){return this._isBeepOnUniqueRead}set isBeepOnUniqueRead(e){this._isBeepOnUniqueRead=e;const t=this.camera.ui.querySelector(".dm-camera-mn-beep-on"),i=this.camera.ui.querySelector(".dm-camera-mn-beep-off");e?(t&&(t.style.display=""),i&&(i.style.display="none")):(t&&(t.style.display="none"),i&&(i.style.display=""))}get isVibrateOnUniqueRead(){return this._isVibrateOnUniqueRead}set isVibrateOnUniqueRead(e){this._isVibrateOnUniqueRead=e;const t=this.camera.ui.querySelector(".dm-camera-mn-vibrate-on"),i=this.camera.ui.querySelector(".dm-camera-mn-vibrate-off");e?(t&&(t.style.display=""),i&&(i.style.display="none")):(t&&(t.style.display="none"),i&&(i.style.display=""))}get videoFit(){return this.camera.objectFit}set videoFit(e){this.camera.objectFit=e}get decodedBarcodeVisible(){return!!this._resultCtx}set decodedBarcodeVisible(e){var t,i;e?null!==(t=this._resultCtx)&&void 0!==t||(this._resultCtx=this.camera.addCanvas().getContext("2d")):null===(i=this._resultCtx)||void 0===i||i.canvas.remove()}get isSaveOriginalCanvas(){return this._isSaveOriginalCanvas}set isSaveOriginalCanvas(e){this._isSaveOriginalCanvas=e,this._framePipeline.isSaveOriginalRgba=e}get originalCanvas(){const e=this._originalImage;if(null==e?void 0:e.canvas)return e.canvas;if(null==e?void 0:e.u8){const t=e.canvas=document.createElement("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d"),o=new ImageData(e.u8,e.width,e.height);return i.putImageData(o,0,0),t}return null}static async createInstance(t="https://cdn.jsdelivr.net/gh/Dynamsoft/easy-barcode-scanner@11.0.3003/mobile-native.ui.xml"){let i=new g;try{let o=i._cvRouter=await e.CaptureVisionRouter.createInstance(),s=i.camera=new h;if(s.easyBarcodeScanner=i,"string"==typeof t&&!t.trimStart().startsWith("<")){let e=await fetch(t);if(!e.ok)throw Error("Failed to load the UI file from network.");t=await e.text()}s.ui=t,i._framePipeline=new u(s),i.decodedBarcodeVisible=!0;let a=i._filter=new e.MultiFrameResultCrossFilter;a.enableResultCrossVerification(e.EnumCapturedResultItemType.CRIT_BARCODE,!0),a.enableResultDeduplication(e.EnumCapturedResultItemType.CRIT_BARCODE,!0),o.addResultFilter(a)}catch(e){throw i.dispose(),e}return i}getUIElement(){return this.camera.ui}setScanRegion(e){this.camera.setRegionBox(e)}async open(){if("opened"!==this.camera.status){if("closed"===this.camera.status){let e=this.camera.ui;e.parentElement||(Object.assign(e.style,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),document.body.append(e),this._bAddToBodyWhenOpen=!0)}await this.camera.open(),this._isLoopingDecoding||(this._isLoopingDecoding=!0,this._loopDecoding(++this._loopDecodingTaskId))}}close(){var e;this._bAddToBodyWhenOpen&&(this._bAddToBodyWhenOpen=!1,document.body.removeChild(this.camera.ui)),this._isLoopingDecoding=!1,null===(e=this.camera)||void 0===e||e.close()}pause(){this._isLoopingDecoding=!1,this.camera.pause()}showOpenFilePicker(e){var t;let i=document.createElement("input");i.type="file",i.accept="image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff",i.multiple=!0;let o=null==e?void 0:e.isSaveOriginalCanvas;return void 0===o&&(o=this.isSaveOriginalCanvas),delete e.isSaveOriginalCanvas,Object.assign(i,e),null!==(t=i.onchange)&&void 0!==t||(i.onchange=async()=>{let e=i.files;for(let t of e){let e=await this.decodeFile(t,o),i=e.barcodeResultItems||[];this.lastFrameSourceType="file",this._originalImage=o?{canvas:e.originalCanvas}:null;try{this.onFrameRead&&this.onFrameRead(i.map((e=>e.text)),{barcodeResultItems:i,errorCode:e.errorCode,errorString:e.errorString})}catch(e){setTimeout((()=>{throw e}),0)}for(let t of i)if(!t.duplicate)try{this.onUniqueRead&&this.onUniqueRead(t.text,{barcodeResultItem:t,errorCode:e.errorCode,errorString:e.errorString})}catch(e){setTimeout((()=>{throw e}),0)}}}),i.click(),i}async decodeFile(t,i=!1){let o=URL.createObjectURL(t),s=document.createElement("img"),a=new Promise(((e,t)=>{s.onload=e,s.onerror=t}));s.src=o;try{await a}finally{URL.revokeObjectURL(o)}let n=document.createElement("canvas");n.width=s.naturalWidth,n.height=s.naturalHeight;let r=n.getContext("2d");r.drawImage(s,0,0);let c=r.getImageData(0,0,n.width,n.height).data,d=await this.decodeBuffer(c,n.width,n.height,4*n.width,e.EnumImagePixelFormat.IPF_ABGR_8888,this.templateName);return i&&(d.originalCanvas=n),d}async decodeBuffer(e,t,i,o,s,a=""){let n=await this._cvRouter.capture({bytes:e,width:t,height:i,stride:o,format:s},a);return n.decodedBarcodesResult||{barcodeResultItems:[],errorCode:n.errorCode,errorString:n.errorString}}async _loopDecoding(t){if(this._isLoopingDecoding&&t==this._loopDecodingTaskId){if("opened"!=this.camera.status)return await new Promise((e=>setTimeout(e,500))),void this._loopDecoding(t);try{let{x:i,y:o,width:s,height:a}=this.camera.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),n=this._framePipeline.getData({x:i,y:o,width:s,height:a,type:"gray"}),r=this._framePipeline.originalRbga,c=await this.decodeBuffer(n,s,a,s,e.EnumImagePixelFormat.IPF_GRAYSCALED,this.templateName);if(!this._isLoopingDecoding||t!=this._loopDecodingTaskId)return;this.lastFrameSourceType="video",this.isSaveOriginalCanvas&&r&&(this._originalImage={u8:r,width:s,height:a});let d=c.barcodeResultItems||[];try{this.onFrameRead&&this.onFrameRead(d.map((e=>e.text)),c)}catch(e){setTimeout((()=>{throw e}),0)}let h=!1;for(let e of d)if(!e.duplicate){h=!0;try{this.onUniqueRead&&this.onUniqueRead(e.text,{barcodeResultItem:e,errorCode:c.errorCode,errorString:c.errorString})}catch(e){setTimeout((()=>{throw e}),0)}}if(this._resultCtx){const e=this._resultCtx,t=e.canvas;e.clearRect(0,0,t.width,t.height),e.fillStyle=this.barcodeFillStyle,e.strokeStyle=this.barcodeStrokeStyle,e.lineWidth=this.barcodeLineWidth;for(let t of d){let s=t.location.points;e.beginPath(),e.moveTo(s[0].x+i,s[0].y+o),e.lineTo(s[1].x+i,s[1].y+o),e.lineTo(s[2].x+i,s[2].y+o),e.lineTo(s[3].x+i,s[3].y+o),e.fill(),e.closePath(),e.stroke()}}h&&this.isBeepOnUniqueRead&&(m??=new p).beep(),h&&this.isVibrateOnUniqueRead&&((e=300)=>{if(!navigator?.vibrate)throw new Error("Not supported.");navigator.vibrate(e)})()}catch(e){setTimeout((()=>{throw e}),0),await new Promise((e=>setTimeout(e,1e3)))}await new Promise((e=>setTimeout(e,this.decodeInterval))),this._loopDecoding(t)}}async turnOnTorch(){await this.camera.turnOnTorch();const e=this.camera.ui.querySelector(".dm-camera-mn-torch-auto");e&&(e.style.display="none");const t=this.camera.ui.querySelector(".dm-camera-mn-torch-on");t&&(t.style.display="");const i=this.camera.ui.querySelector(".dm-camera-mn-torch-off");i&&(i.style.display="none")}async turnOffTorch(){this.camera.turnOffTorch();const e=this.camera.ui.querySelector(".dm-camera-mn-torch-auto");e&&(e.style.display="none");const t=this.camera.ui.querySelector(".dm-camera-mn-torch-on");t&&(t.style.display="none");const i=this.camera.ui.querySelector(".dm-camera-mn-torch-off");i&&(i.style.display="")}turnAutoTorch(){if(!this.camera.isSupportTorch)throw Error("Torch Not Supported");this.camera.turnAutoTorch();const e=this.camera.ui.querySelector(".dm-camera-mn-torch-auto");e&&(e.style.display="");const t=this.camera.ui.querySelector(".dm-camera-mn-torch-on");t&&(t.style.display="none");const i=this.camera.ui.querySelector(".dm-camera-mn-torch-off");i&&(i.style.display="none")}videoXY2AbsoluteLT(e){return this.camera.videoXY2AbsoluteLT(e)}videoXY2FixedLT(e){return this.camera.videoXY2FixedLT(e)}getVisibleAreaInVideoXY(e){return this.camera.getVisibleAreaInVideoXY(e)}dispose(){var e;this.close(),null===(e=this._cvRouter)||void 0===e||e.dispose()}static async scan(e="https://cdn.jsdelivr.net/gh/Dynamsoft/easy-barcode-scanner@11.0.3003/easy-barcode-scanner.ui.xml"){return await new Promise((async(t,i)=>{let o=await g.createInstance(e),s=new Promise((e=>{o.onFrameRead=(t,{barcodeResultItems:i})=>{var s,a;(null==i?void 0:i.length)?e(i):"file"===o.lastFrameSourceType&&(null===(a=(s=o).mnFuncShowToast)||void 0===a||a.call(s,"No barcode found in the file."))}})),a=o.getUIElement(),n=a.querySelector(".easyscanner-close-btn");n.addEventListener("click",(()=>{o.dispose(),t(null)})),a.querySelector(".easyscanner-photo-album-btn").addEventListener("click",(()=>{o.showOpenFilePicker({multiple:!1,isSaveOriginalCanvas:!0})})),a.querySelector(".easyscanner-flash-btn").addEventListener("pointerdown",(()=>{let e=a.querySelectorAll(".dm-camera-mn-torch > svg");for(let t of e)if("none"!=t.style.display){t.dispatchEvent(new Event("pointerdown"));break}}));let r=!1;if(await h.hasCamera())try{await o.open()}catch(e){console.warn(e),r=!0}r&&(console.warn("No camera available, failback to image mode."),o.showOpenFilePicker({multiple:!1,isSaveOriginalCanvas:!0}));let c=await s;if(0===c.length)return o.dispose(),void t(null);if(1===c.length)return o.dispose(),void t(c[0].text);if("file"===o.lastFrameSourceType){const e=o.originalCanvas;Object.assign(e.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",objectFit:"contain",background:"black"}),a.appendChild(e)}let d=document.createElement("div");d.className="easyscanner-barcode-result-select-mask",a.append(d);let l=new Promise((e=>{let t=[];for(let e of c){let i=0,o=0;for(let t=0;t<4;++t){let s=e.location.points[t];i+=s.x,o+=s.y}t.push({x:i/4,y:o/4})}let i=[];if("video"===o.lastFrameSourceType){let{x:e,y:s}=o.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),a=t.map((t=>({x:t.x+e,y:t.y+s})));i=o.videoXY2FixedLT(a)}else{if("file"!==o.lastFrameSourceType)throw Error(`unknown frame source type: ${o.lastFrameSourceType}`);{let e=document.documentElement.clientWidth,s=document.documentElement.clientHeight,a=o.originalCanvas,n=a.width,r=a.height,c=e,d=s,h=0,l=0;e/s>n/r?(c=d/r*n,h=(e-c)/2):(d=c/n*r,l=(s-d)/2),i=t.map((e=>({left:h+e.x/n*c,top:l+e.y/r*d})))}}for(let t of c){let o=document.createElement("div");o.className="easyscanner-barcode-result-option";let{left:s,top:n}=i.shift();o.style.left=s+"px",o.style.top=n+"px",o.addEventListener("click",(()=>{e(t.text)})),a.append(o)}})),u=document.createElement("div");u.className="easyscanner-barcode-result-select-tip",u.textContent="Multiple scans found, please select one.",a.append(u),a.append(n),o.pause();let p=await l;o.dispose(),t(p)}))}}return g}));
